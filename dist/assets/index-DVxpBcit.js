const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/accolades-DjalMCk9.js","assets/utils-CFjXnQ4s.js","assets/accolade-ywHU92jA.js"])))=>i.map(i=>d[i]);
(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function i(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(r){if(r.ep)return;r.ep=!0;const l=i(r);fetch(r.href,l)}})();function A(){document.querySelectorAll("[data-include]").forEach(o=>{const i=o.getAttribute("data-include");i&&fetch(i).then(s=>{if(!s.ok)throw new Error(`Failed to fetch ${i}`);return s.text()}).then(s=>{o.innerHTML=s,i.includes("nav.html")&&document.dispatchEvent(new Event("nav-ready"))}).catch(s=>{console.error(`[includes.js] Error loading ${i}:`,s)})})}const d={apiBase:"http://localhost:8003",redirectUri:"http://localhost:4173/",discordClientId:"1013095667201228810"};function k(){console.log("finishDiscordLogin triggered.");const o=new URLSearchParams(window.location.search).get("code");if(console.log("Parsed code from URL:",o),!o){console.log("No code found in URL ‚Äî skipping login finish.");return}fetch(`${d.apiBase}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:o,redirectUri:d.redirectUri})}).then(i=>(console.log("Received response:",i),i.json())).then(i=>{console.log("Parsed response JSON:",i),i&&i.token?(localStorage.setItem("jwt",i.token),console.log("‚úÖ JWT stored:",i.token)):console.warn("[auth] No token received from API:",i),window.location.href=d.redirectUri}).catch(i=>{console.error("‚ùå Error finishing Discord login:",i)})}function L(){try{const e=localStorage.getItem("jwt");return!e||e==="undefined"?null:JSON.parse(atob(e.split(".")[1]))}catch(e){return console.warn("[auth] Failed to decode JWT:",e),null}}function w(){const e=d==null?void 0:d.discordClientId,o=d==null?void 0:d.redirectUri,i=`https://discord.com/oauth2/authorize?response_type=code&client_id=${e}&scope=identify+guilds.members.read&redirect_uri=${o}`;window.location.href=i}function y(){localStorage.removeItem("jwt"),console.log("üîí Logged out. Reloading..."),window.location.reload()}console.log("[nav] Script start");async function T(e=1e3){const o=["login-btn","logout-btn","user-info","display-name"],i=Date.now();for(;Date.now()-i<e;){if(o.filter(r=>!document.getElementById(r)).length===0)return!0;await new Promise(r=>setTimeout(r,50))}return console.warn("[nav] Timeout waiting for nav elements"),!1}const g=e=>{const o=document.getElementById(e);o&&(console.log(`[nav] Showing ${e}`),o.classList.remove("hidden"))},c=e=>{const o=document.getElementById(e);o&&(console.log(`[nav] Hiding ${e}`),o.classList.add("hidden"),e==="user-info"&&o.classList.remove("lg:inline-block"))};function p(){const e=localStorage.getItem("jwt");console.log("[nav] Token:",e),T().then(()=>{var s,r,l,n,t;let o=null;if(e)try{o=L(),console.log("[nav] User:",o)}catch(v){console.warn("[nav] Failed to get user:",v)}const i=(s=o==null?void 0:o.roles)==null?void 0:s.includes("Server Admin");console.log("[nav] Is admin:",i),(r=document.getElementById("login-btn"))==null||r.addEventListener("click",w),(l=document.getElementById("login-btn-mobile"))==null||l.addEventListener("click",w),(n=document.getElementById("logout-btn"))==null||n.addEventListener("click",y),(t=document.getElementById("logout-btn-mobile"))==null||t.addEventListener("click",y),o?(document.getElementById("display-name").textContent=o.displayName,g("user-info"),g("logout-btn"),g("logout-btn-mobile"),c("login-btn"),c("login-btn-mobile"),i?(g("admin-link"),g("admin-link-mobile"),g("admin-container")):(c("admin-link"),c("admin-link-mobile"),c("admin-container"),window.location.pathname.includes("admin.html")&&(console.log("[nav] Redirecting non-admin"),navigateTo("./unauthorized.html")))):(g("login-btn"),g("login-btn-mobile"),c("logout-btn"),c("logout-btn-mobile"),c("user-info"),c("admin-link"),c("admin-link-mobile"),c("admin-container"),window.location.pathname.includes("admin.html")&&(console.log("[nav] Redirecting unauthenticated user"),navigateTo("./unauthorized.html"))),console.log("[nav] Logic complete")})}document.addEventListener("nav-ready",()=>{console.log("[nav] nav-ready fired"),p()});document.addEventListener("login-success",()=>{console.log("[nav] login-success event received ‚Äî rerunning logic"),p()});document.addEventListener("nav-ready",()=>{console.log("[nav] nav-ready fired");const e=document.getElementById("nav-toggle"),o=document.getElementById("nav-menu-mobile");e&&o?(console.log("[nav] Hamburger elements found ‚Äî binding toggle"),e.addEventListener("click",()=>{console.log("[nav] Toggling mobile menu"),o.classList.toggle("hidden"),o.style.maxHeight=o.classList.contains("hidden")?null:o.scrollHeight+"px"})):console.warn("[nav] Couldn't find nav-toggle or nav-menu-mobile")});function O(){p()}const R="modulepreload",j=function(e){return"/"+e},E={},m=function(o,i,s){let r=Promise.resolve();if(i&&i.length>0){let n=function(a){return Promise.all(a.map(f=>Promise.resolve(f).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),v=(t==null?void 0:t.nonce)||(t==null?void 0:t.getAttribute("nonce"));r=n(i.map(a=>{if(a=j(a),a in E)return;E[a]=!0;const f=a.endsWith(".css"),h=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${h}`))return;const u=document.createElement("link");if(u.rel=f?"stylesheet":R,f||(u.as="script"),u.crossOrigin="",u.href=a,v&&u.setAttribute("nonce",v),document.head.appendChild(u),f)return new Promise((P,S)=>{u.addEventListener("load",P),u.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${a}`)))})}))}function l(n){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=n,window.dispatchEvent(t),!t.defaultPrevented)throw n}return r.then(n=>{for(const t of n||[])t.status==="rejected"&&l(t.reason);return o().catch(l)})},b={"/":"views/home.html","/accolades":"views/accolades.html","/accolade":"views/accolade.html","/events":"views/events.html","/admin":"views/admin.html","/log-search":"views/log-search.html","/unauthorized":"views/unauthorized.html"};function _(e){history.pushState(null,null,e),I()}async function I(){var s;const e=window.location.pathname,o=b[e]||b["/"],i=document.getElementById("view-container");if(console.log(`[router] path: ${e}`),console.log(`[router] route: ${o}`),e==="/admin"||e==="/log-search"){const r=await L(),l=(s=r==null?void 0:r.roles)==null?void 0:s.includes("Server Admin");if(!r||!l){console.warn("[router] Access denied to /admin for non-admin user."),_("/unauthorized");return}}try{console.log(`[router] fetching: /${o}`);const r=await fetch("/"+o);if(!r.ok)throw new Error("Failed to fetch view: "+o);const l=await r.text();console.log(l),i.innerHTML=l,e.includes("accolades")?(console.log("[router] importing accolades.js"),m(()=>import("./accolades-DjalMCk9.js"),__vite__mapDeps([0,1])).then(n=>{var t;return(t=n.init)==null?void 0:t.call(n)})):e.includes("accolade")?(console.log("[router] importing accolade.js"),m(()=>import("./accolade-ywHU92jA.js"),__vite__mapDeps([2,1])).then(n=>{var t;return(t=n.init)==null?void 0:t.call(n)})):e.includes("events")?(console.log("[router] importing events.js"),m(()=>import("./events-xaGk2lL2.js"),[]).then(n=>{var t;return(t=n.init)==null?void 0:t.call(n)})):e.includes("admin")?(console.log("[router] importing admin.js"),m(()=>Promise.resolve().then(()=>U),void 0).then(n=>{var t;return(t=n.init)==null?void 0:t.call(n)})):e.includes("log-search")?(console.log("[router] importing log-search.js"),m(()=>import("./log-search-CSrlZ6gH.js"),[]).then(n=>{var t;return(t=n.init)==null?void 0:t.call(n)})):e.includes("unauthorized")?(console.log("[router] importing unauthorized.js"),m(()=>import("./unauthorized-dsxlyb9t.js"),[]).then(n=>{var t;return(t=n.init)==null?void 0:t.call(n)})):(e==="/"||e==="/home")&&(console.log("[router] importing home.js"),m(()=>import("./home-CqPHE_cx.js"),[]).then(n=>{var t;return(t=n.init)==null?void 0:t.call(n)}))}catch(r){console.error("[router] Error loading route:",r),i.innerHTML='<p class="text-red-500 text-center">Error loading page.</p>'}}function D(){document.body.addEventListener("click",e=>{e.target.matches("a[data-link]")&&(e.preventDefault(),_(e.target.href))}),I()}function B(){D()}console.log("[MAIN] Booting up...");window.addEventListener("DOMContentLoaded",async()=>{if(console.log("[MAIN] DOM loaded"),new URLSearchParams(window.location.search).get("code")){console.log("[Auth] OAuth code found, finishing login...");try{await k()}catch(i){console.error("[Auth] Failed to finish Discord login:",i)}}A(),O(),B(),console.log("[MAIN] Booted up successfully")});const U=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{d as P};
