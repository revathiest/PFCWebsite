const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/accolades-DsWrcGmc.js","assets/utils-CFjXnQ4s.js","assets/accolade-ByYtd59Z.js"])))=>i.map(i=>d[i]);
(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function c(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();function S(){document.querySelectorAll("[data-include]").forEach(n=>{const t=n.getAttribute("data-include");t&&fetch(t).then(c=>{if(!c.ok)throw new Error(`Failed to fetch ${t}`);return c.text()}).then(c=>{n.innerHTML=c,t.includes("nav.html")&&document.dispatchEvent(new Event("nav-ready"))}).catch(c=>{console.error(`[includes.js] Error loading ${t}:`,c)})})}const u={apiBase:"https://api.pyrofreelancercorps.com",redirectUri:"https://pyrofreelancercorps.com/",discordClientId:"819004565869035531"};function A(){console.log("finishDiscordLogin triggered.");const n=new URLSearchParams(window.location.search).get("code");if(console.log("Parsed code from URL:",n),!n){console.log("No code found in URL ‚Äî skipping login finish.");return}fetch(`${u.apiBase}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n,redirectUri:u.redirectUri})}).then(t=>(console.log("Received response:",t),t.json())).then(t=>{console.log("Parsed response JSON:",t),t&&t.token?(localStorage.setItem("jwt",t.token),console.log("‚úÖ JWT stored:",t.token)):console.warn("[auth] No token received from API:",t),window.location.href=u.redirectUri}).catch(t=>{console.error("‚ùå Error finishing Discord login:",t)})}function _(){try{const e=localStorage.getItem("jwt");return!e||e==="undefined"?null:JSON.parse(atob(e.split(".")[1]))}catch(e){return console.warn("[auth] Failed to decode JWT:",e),null}}function E(){const e=u==null?void 0:u.discordClientId,n=u==null?void 0:u.redirectUri,t=`https://discord.com/oauth2/authorize?response_type=code&client_id=${e}&scope=identify+guilds.members.read&redirect_uri=${n}`;window.location.href=t}function y(){localStorage.removeItem("jwt"),console.log("üîí Logged out. Reloading..."),window.location.reload()}console.log("[nav] Script start");async function k(e=1e3){const n=["login-btn","logout-btn","user-info","display-name"],t=Date.now();for(;Date.now()-t<e;){if(n.filter(i=>!document.getElementById(i)).length===0)return!0;await new Promise(i=>setTimeout(i,50))}return console.warn("[nav] Timeout waiting for nav elements"),!1}const m=e=>{const n=document.getElementById(e);n&&(console.log(`[nav] Showing ${e}`),n.classList.remove("hidden"))},d=e=>{const n=document.getElementById(e);n&&(console.log(`[nav] Hiding ${e}`),n.classList.add("hidden"),e==="user-info"&&n.classList.remove("lg:inline-block"))};function w(){const e=localStorage.getItem("jwt");console.log("[nav] Token:",e),k().then(()=>{var c,i,l,a,s;let n=null;if(e)try{n=_(),console.log("[nav] User:",n)}catch(f){console.warn("[nav] Failed to get user:",f)}const t=(c=n==null?void 0:n.roles)==null?void 0:c.includes("Server Admin");console.log("[nav] Is admin:",t),(i=document.getElementById("login-btn"))==null||i.addEventListener("click",E),(l=document.getElementById("login-btn-mobile"))==null||l.addEventListener("click",E),(a=document.getElementById("logout-btn"))==null||a.addEventListener("click",y),(s=document.getElementById("logout-btn-mobile"))==null||s.addEventListener("click",y),n?(document.getElementById("display-name").textContent=n.displayName,m("user-info"),m("logout-btn"),m("logout-btn-mobile"),d("login-btn"),d("login-btn-mobile"),t?(m("admin-link"),m("admin-link-mobile"),m("admin-container")):(d("admin-link"),d("admin-link-mobile"),d("admin-container"),window.location.pathname.includes("admin.html")&&(console.log("[nav] Redirecting non-admin"),navigateTo("./unauthorized.html")))):(m("login-btn"),m("login-btn-mobile"),d("logout-btn"),d("logout-btn-mobile"),d("user-info"),d("admin-link"),d("admin-link-mobile"),d("admin-container"),window.location.pathname.includes("admin.html")&&(console.log("[nav] Redirecting unauthenticated user"),navigateTo("./unauthorized.html"))),console.log("[nav] Logic complete")})}document.addEventListener("nav-ready",()=>{console.log("[nav] nav-ready fired"),w()});document.addEventListener("login-success",()=>{console.log("[nav] login-success event received ‚Äî rerunning logic"),w()});document.addEventListener("nav-ready",()=>{console.log("[nav] nav-ready fired");const e=document.getElementById("nav-toggle"),n=document.getElementById("nav-menu-mobile");e&&n?(console.log("[nav] Hamburger elements found ‚Äî binding toggle"),e.addEventListener("click",()=>{console.log("[nav] Toggling mobile menu"),n.classList.toggle("hidden"),n.style.maxHeight=n.classList.contains("hidden")?null:n.scrollHeight+"px"})):console.warn("[nav] Couldn't find nav-toggle or nav-menu-mobile")});function O(){w()}const R="modulepreload",j=function(e){return"/"+e},L={},h=function(n,t,c){let i=Promise.resolve();if(t&&t.length>0){let a=function(o){return Promise.all(o.map(r=>Promise.resolve(r).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),f=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));i=a(t.map(o=>{if(o=j(o),o in L)return;L[o]=!0;const r=o.endsWith(".css"),v=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${v}`))return;const g=document.createElement("link");if(g.rel=r?"stylesheet":R,r||(g.as="script"),g.crossOrigin="",g.href=o,f&&g.setAttribute("nonce",f),document.head.appendChild(g),r)return new Promise((P,T)=>{g.addEventListener("load",P),g.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${o}`)))})}))}function l(a){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return i.then(a=>{for(const s of a||[])s.status==="rejected"&&l(s.reason);return n().catch(l)})},p={"/":"views/home.html","/accolades":"views/accolades.html","/accolade":"views/accolade.html","/events":"views/events.html","/admin":"views/admin.html","/log-search":"views/log-search.html","/unauthorized":"views/unauthorized.html","/shop":"views/shop.html","/product/:handle":"views/shop.html"};function b(e){history.pushState(null,null,e),I()}async function I(){var c;const e=window.location.pathname;let n=p[e];n||(e.startsWith("/product/")?n=p["/product/:handle"]:n=p["/"]);const t=document.getElementById("view-container");if(!t){console.error("[router] view-container not found!");return}if(console.log(`[router] path: ${e}`),console.log(`[router] route: ${n}`),e==="/admin"||e==="/log-search"){const i=await _(),l=(c=i==null?void 0:i.roles)==null?void 0:c.includes("Server Admin");if(!i||!l){console.warn("[router] Access denied to /admin for non-admin user."),b("/unauthorized");return}}try{console.log(`[router] fetching: /${n}`);const i=await fetch("/"+n);if(!i.ok)throw new Error("Failed to fetch view: "+n);const l=await i.text(),a=document.createElement("div");a.innerHTML=l;const s=a.querySelector("#view-container");s?t.innerHTML=s.innerHTML:t.innerHTML=l;const f=new Event("nav-ready");window.dispatchEvent(f),e.includes("accolades")?(console.log("[router] importing accolades.js"),h(()=>import("./accolades-DsWrcGmc.js"),__vite__mapDeps([0,1])).then(o=>{var r;return(r=o.init)==null?void 0:r.call(o)})):e.includes("accolade")?(console.log("[router] importing accolade.js"),h(()=>import("./accolade-ByYtd59Z.js"),__vite__mapDeps([2,1])).then(o=>{var r;return(r=o.init)==null?void 0:r.call(o)})):e.includes("events")?(console.log("[router] importing events.js"),h(()=>import("./events-C_v65-Ol.js"),[]).then(o=>{var r;return(r=o.init)==null?void 0:r.call(o)})):e.includes("admin")?(console.log("[router] importing admin.js"),h(()=>Promise.resolve().then(()=>U),void 0).then(o=>{var r;return(r=o.init)==null?void 0:r.call(o)})):e.includes("log-search")?(console.log("[router] importing log-search.js"),h(()=>import("./log-search-C08i5Yeq.js"),[]).then(o=>{var r;return(r=o.init)==null?void 0:r.call(o)})):e.includes("unauthorized")?(console.log("[router] importing unauthorized.js"),h(()=>import("./unauthorized-dsxlyb9t.js"),[]).then(o=>{var r;return(r=o.init)==null?void 0:r.call(o)})):e==="/"||e==="/home"?(console.log("[router] importing home.js"),h(()=>import("./home-Co54YFg7.js"),[]).then(o=>{var r;return(r=o.init)==null?void 0:r.call(o)})):(e.startsWith("/shop")||e.startsWith("/product/"))&&(console.log("[router] importing shop.js"),h(()=>import("./shop-DNcuPkB9.js"),[]).then(o=>{var r;return(r=o.init)==null?void 0:r.call(o,e)}))}catch(i){console.error("[router] Error loading route:",i),t.innerHTML='<p class="text-red-500 text-center">Error loading page.</p>'}}function D(){document.body.addEventListener("click",e=>{e.target.matches("a[data-link]")&&(e.preventDefault(),b(e.target.href))}),I()}function B(){D()}console.log("[MAIN] Booting up...");window.addEventListener("DOMContentLoaded",async()=>{if(console.log("[MAIN] DOM loaded"),new URLSearchParams(window.location.search).get("code")){console.log("[Auth] OAuth code found, finishing login...");try{await A()}catch(t){console.error("[Auth] Failed to finish Discord login:",t)}}S(),O(),B(),console.log("[MAIN] Booted up successfully")});const U=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{u as P};
