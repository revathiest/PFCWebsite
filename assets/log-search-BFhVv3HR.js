import{P as u}from"./index-BzKmCfEC.js";async function v(){const a=localStorage.getItem("jwt");if(!a)return;const n={Authorization:`Bearer ${a}`};try{const[e,o]=await Promise.all([fetch(`${u.apiBase}/api/commands`,{headers:n}),fetch(`${u.apiBase}/api/members`,{headers:n})]);if(!e.ok){const t=await e.text();throw console.error("Command fetch failed:",e.status,t),new Error("Failed to load commands")}if(!o.ok){const t=await o.text();throw console.error("Member fetch failed:",o.status,t),new Error("Failed to load members")}const r=e.headers.get("content-type")||"",c=o.headers.get("content-type")||"",m=r.includes("application/json")?(await e.json()).commands||[]:(console.error("Commands response not JSON:",r),[]),p=c.includes("application/json")?((await o.json()).members||[]).sort((t,l)=>(t.displayName||"").localeCompare(l.displayName||"")):(console.error("Members response not JSON:",c),[]),d=document.getElementById("command");d.innerHTML='<option value="">Any</option>'+m.map(t=>`<option value="${t}">${t}</option>`).join("");const s=document.getElementById("userId");s.innerHTML='<option value="">Any</option>'+p.map(t=>`<option value="${t.userId}">${t.displayName}</option>`).join("");const i=document.getElementById("type");try{const t=await fetch(`${u.apiBase}/api/activity-log/event-types`,{headers:n}),y=(t.headers.get("content-type")||"").includes("application/json")?await t.json():{eventTypes:[]},f=Array.isArray(y.eventTypes)?y.eventTypes:[];i.innerHTML='<option value="">Any</option>'+f.map(h=>`<option value="${h}">${h}</option>`).join("")}catch(t){console.error("Failed to load event types:",t)}}catch(e){console.error("Failed to populate filters:",e)}}function g(a=[]){const n=document.getElementById("results");if(!Array.isArray(a)||a.length===0){n.innerHTML='<p class="text-gray-300">No results found.</p>';return}n.innerHTML=a.map(e=>{var i,t,l;const o=new Date(e.timestamp).toLocaleString(),r=((i=e.interaction_type)==null?void 0:i.toUpperCase())||((t=e.event_type)==null?void 0:t.toUpperCase())||"UNKNOWN",c=e.displayName||e.memberName||e.user_id,m=e.channelName?`in #${e.channelName}`:"",p=e.command_name?`used /${e.command_name}`:"",d=(l=e.message_content)!=null&&l.trim()?`â€” "${e.message_content}"`:"",s=[c,p||d,m,`@ ${o}`].filter(Boolean).join(" ");return`
      <div class="p-2 bg-gray-800 rounded shadow text-sm">
        <div><strong>[${r}]</strong> ${s}</div>
      </div>
    `}).join("")}async function w(a){const n=localStorage.getItem("jwt"),e=n?{Authorization:`Bearer ${n}`}:{},o=new URLSearchParams,r=document.getElementById("type").value,c=document.getElementById("userId").value,m=document.getElementById("command").value,p=document.getElementById("message").value;r&&o.set("type",r),c&&o.set("userId",c),m&&o.set("command",m),p&&o.set("message",p);const d=`${u.apiBase}/api/activity-log/search?${o.toString()}`;try{const s=await fetch(d,{headers:e});if(!s.ok)throw new Error(`HTTP ${s.status}`);const i=await s.json();g(i.logs||i.results||[])}catch(s){console.error("Search failed",s)}}async function I(){var a;try{await v(),(a=document.getElementById("search-button"))==null||a.addEventListener("click",n=>{n.preventDefault(),w()})}catch(n){console.error("[ERROR] Failed to load site content:",n)}}export{I as init};
