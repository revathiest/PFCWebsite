const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/accolades-VN6enhzF.js","assets/utils-CFjXnQ4s.js","assets/accolade-E12fl1ZH.js"])))=>i.map(i=>d[i]);
(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(i){if(i.ep)return;i.ep=!0;const l=r(i);fetch(i.href,l)}})();function S(){document.querySelectorAll("[data-include]").forEach(n=>{const r=n.getAttribute("data-include");r&&fetch(r).then(s=>{if(!s.ok)throw new Error(`Failed to fetch ${r}`);return s.text()}).then(s=>{n.innerHTML=s,r.includes("nav.html")&&document.dispatchEvent(new Event("nav-ready"))}).catch(s=>{console.error(`[includes.js] Error loading ${r}:`,s)})})}const v={apiBase:void 0,redirectUri:void 0,discordClientId:void 0};function A(){console.log("finishDiscordLogin triggered.");const n=new URLSearchParams(window.location.search).get("code");if(console.log("Parsed code from URL:",n),!n){console.log("No code found in URL ‚Äî skipping login finish.");return}fetch(`${v.apiBase}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n,redirectUri:v.redirectUri})}).then(r=>(console.log("Received response:",r),r.json())).then(r=>{console.log("Parsed response JSON:",r),r&&r.token?(localStorage.setItem("jwt",r.token),console.log("‚úÖ JWT stored:",r.token)):console.warn("[auth] No token received from API:",r),window.location.href=v.redirectUri}).catch(r=>{console.error("‚ùå Error finishing Discord login:",r)})}function b(){try{const e=localStorage.getItem("jwt");return!e||e==="undefined"?null:JSON.parse(atob(e.split(".")[1]))}catch(e){return console.warn("[auth] Failed to decode JWT:",e),null}}function w(){{console.error("[auth] Missing Discord Client ID in PFC_CONFIG");return}}function E(){localStorage.removeItem("jwt"),console.log("üîí Logged out. Reloading..."),window.location.reload()}console.log("[nav] Script start");async function k(e=1e3){const n=["login-btn","logout-btn","user-info","display-name"],r=Date.now();for(;Date.now()-r<e;){if(n.filter(i=>!document.getElementById(i)).length===0)return!0;await new Promise(i=>setTimeout(i,50))}return console.warn("[nav] Timeout waiting for nav elements"),!1}const u=e=>{const n=document.getElementById(e);n&&(console.log(`[nav] Showing ${e}`),n.classList.remove("hidden"))},c=e=>{const n=document.getElementById(e);n&&(console.log(`[nav] Hiding ${e}`),n.classList.add("hidden"),e==="user-info"&&n.classList.remove("lg:inline-block"))};function p(){const e=localStorage.getItem("jwt");console.log("[nav] Token:",e),k().then(()=>{var s,i,l,o,t;let n=null;if(e)try{n=b(),console.log("[nav] User:",n)}catch(h){console.warn("[nav] Failed to get user:",h)}const r=(s=n==null?void 0:n.roles)==null?void 0:s.includes("Server Admin");console.log("[nav] Is admin:",r),(i=document.getElementById("login-btn"))==null||i.addEventListener("click",w),(l=document.getElementById("login-btn-mobile"))==null||l.addEventListener("click",w),(o=document.getElementById("logout-btn"))==null||o.addEventListener("click",E),(t=document.getElementById("logout-btn-mobile"))==null||t.addEventListener("click",E),n?(document.getElementById("display-name").textContent=n.displayName,u("user-info"),u("logout-btn"),u("logout-btn-mobile"),c("login-btn"),c("login-btn-mobile"),r?(u("admin-link"),u("admin-link-mobile"),u("admin-container")):(c("admin-link"),c("admin-link-mobile"),c("admin-container"),window.location.pathname.includes("admin.html")&&(console.log("[nav] Redirecting non-admin"),navigateTo("./unauthorized.html")))):(u("login-btn"),u("login-btn-mobile"),c("logout-btn"),c("logout-btn-mobile"),c("user-info"),c("admin-link"),c("admin-link-mobile"),c("admin-container"),window.location.pathname.includes("admin.html")&&(console.log("[nav] Redirecting unauthenticated user"),navigateTo("./unauthorized.html"))),console.log("[nav] Logic complete")})}document.addEventListener("nav-ready",()=>{console.log("[nav] nav-ready fired"),p()});document.addEventListener("login-success",()=>{console.log("[nav] login-success event received ‚Äî rerunning logic"),p()});document.addEventListener("nav-ready",()=>{console.log("[nav] nav-ready fired");const e=document.getElementById("nav-toggle"),n=document.getElementById("nav-menu-mobile");e&&n?(console.log("[nav] Hamburger elements found ‚Äî binding toggle"),e.addEventListener("click",()=>{console.log("[nav] Toggling mobile menu"),n.classList.toggle("hidden"),n.style.maxHeight=n.classList.contains("hidden")?null:n.scrollHeight+"px"})):console.warn("[nav] Couldn't find nav-toggle or nav-menu-mobile")});function T(){p()}const D="modulepreload",R=function(e){return"/"+e},y={},g=function(n,r,s){let i=Promise.resolve();if(r&&r.length>0){let o=function(a){return Promise.all(a.map(m=>Promise.resolve(m).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),h=(t==null?void 0:t.nonce)||(t==null?void 0:t.getAttribute("nonce"));i=o(r.map(a=>{if(a=R(a),a in y)return;y[a]=!0;const m=a.endsWith(".css"),f=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${f}`))return;const d=document.createElement("link");if(d.rel=m?"stylesheet":D,m||(d.as="script"),d.crossOrigin="",d.href=a,h&&d.setAttribute("nonce",h),document.head.appendChild(d),m)return new Promise((P,O)=>{d.addEventListener("load",P),d.addEventListener("error",()=>O(new Error(`Unable to preload CSS for ${a}`)))})}))}function l(o){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=o,window.dispatchEvent(t),!t.defaultPrevented)throw o}return i.then(o=>{for(const t of o||[])t.status==="rejected"&&l(t.reason);return n().catch(l)})},L={"/":"views/home.html","/accolades":"views/accolades.html","/accolade":"views/accolade.html","/events":"views/events.html","/admin":"views/admin.html","/log-search":"views/log-search.html","/unauthorized":"views/unauthorized.html"};function _(e){history.pushState(null,null,e),I()}async function I(){var s;const e=window.location.pathname,n=L[e]||L["/"],r=document.getElementById("view-container");if(console.log(`[router] path: ${e}`),console.log(`[router] route: ${n}`),e==="/admin"||e==="/log-search"){const i=await b(),l=(s=i==null?void 0:i.roles)==null?void 0:s.includes("Server Admin");if(!i||!l){console.warn("[router] Access denied to /admin for non-admin user."),_("/unauthorized");return}}try{console.log(`[router] fetching: /${n}`);const i=await fetch("/"+n);if(!i.ok)throw new Error("Failed to fetch view: "+n);const l=await i.text();r.innerHTML=l,e.includes("accolades")?(console.log("[router] importing accolades.js"),g(()=>import("./accolades-VN6enhzF.js"),__vite__mapDeps([0,1])).then(o=>{var t;return(t=o.init)==null?void 0:t.call(o)})):e.includes("accolade")?(console.log("[router] importing accolade.js"),g(()=>import("./accolade-E12fl1ZH.js"),__vite__mapDeps([2,1])).then(o=>{var t;return(t=o.init)==null?void 0:t.call(o)})):e.includes("events")?(console.log("[router] importing events.js"),g(()=>import("./events-BAowBPGg.js"),[]).then(o=>{var t;return(t=o.init)==null?void 0:t.call(o)})):e.includes("admin")?(console.log("[router] importing admin.js"),g(()=>Promise.resolve().then(()=>N),void 0).then(o=>{var t;return(t=o.init)==null?void 0:t.call(o)})):e.includes("log-search")?(console.log("[router] importing log-search.js"),g(()=>import("./log-search-C_P8n49u.js"),[]).then(o=>{var t;return(t=o.init)==null?void 0:t.call(o)})):e.includes("unauthorized")?(console.log("[router] importing unauthorized.js"),g(()=>import("./unauthorized-dsxlyb9t.js"),[]).then(o=>{var t;return(t=o.init)==null?void 0:t.call(o)})):(e==="/"||e==="/home")&&(console.log("[router] importing home.js"),g(()=>import("./home-DS8Ewcoe.js"),[]).then(o=>{var t;return(t=o.init)==null?void 0:t.call(o)}))}catch(i){console.error("[router] Error loading route:",i),r.innerHTML='<p class="text-red-500 text-center">Error loading page.</p>'}}function j(){document.body.addEventListener("click",e=>{e.target.matches("a[data-link]")&&(e.preventDefault(),_(e.target.href))}),I()}function B(){j()}console.log("[MAIN] Booting up...");window.addEventListener("DOMContentLoaded",async()=>{if(console.log("[MAIN] DOM loaded"),new URLSearchParams(window.location.search).get("code")){console.log("[Auth] OAuth code found, finishing login...");try{await A()}catch(r){console.error("[Auth] Failed to finish Discord login:",r)}}S(),T(),B(),console.log("[MAIN] Booted up successfully")});const N=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{v as P};
