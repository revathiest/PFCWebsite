import{P as s}from"./index-CJK2gzTJ.js";async function l(){const e=document.getElementById("section-select"),a=document.getElementById("content-error");if(e)try{const n=await fetch(`${s.apiBase}/api/content`);if(!n.ok)throw new Error(`HTTP ${n.status}`);const t=await n.json();let r=[];Array.isArray(t.sections)?r=t.sections.map(o=>({key:o})):Array.isArray(t.content)?r=t.content:Array.isArray(t.contents)?r=t.contents:Array.isArray(t)?r=t:t&&typeof t=="object"&&(r=Object.entries(t).map(([o,i])=>({key:o,...i||{}})));const c=r.map(o=>({value:o.key||o.id||o.name,label:o.name||o.title||o.key||o.id})).filter(o=>o.value);e.innerHTML='<option value="">Choose a section</option>'+c.map(o=>`<option value="${o.value}">${o.label}</option>`).join("")}catch(n){console.error("[content-manager] Failed to load sections",n),a&&(a.textContent="Failed to load sections.")}}async function d(e){const a=document.getElementById("content-area"),n=document.getElementById("content-error");if(a)try{const t=await fetch(`${s.apiBase}/api/content/${e}`);if(!t.ok)throw new Error(`HTTP ${t.status}`);const r=await t.json();a.value=r.content||r.value||""}catch(t){console.error(`[content-manager] Failed to load content for ${e}`,t),n&&(n.textContent=`Failed to load content for ${e}.`),a.value=""}}async function u(e){const a=document.getElementById("content-area"),n=document.getElementById("content-error");if(!a)return;const t=localStorage.getItem("jwt"),r={"Content-Type":"application/json"};t&&(r.Authorization=`Bearer ${t}`);try{const c=await fetch(`${s.apiBase}/api/content/${e}`,{method:"PUT",headers:r,body:JSON.stringify({content:a.value})});if(!c.ok)throw new Error(`HTTP ${c.status}`);n&&(n.textContent="Content saved.")}catch(c){console.error("[content-manager] Failed to save content",c),n&&(n.textContent="Failed to save content.")}}async function f(){try{await l();const e=document.getElementById("section-select"),a=document.getElementById("content-area"),n=document.getElementById("save-button");e==null||e.addEventListener("change",t=>{const r=t.target.value;document.getElementById("content-error").textContent="",r?(d(r),a==null||a.focus()):a&&(a.value="")}),n==null||n.addEventListener("click",()=>{const t=e==null?void 0:e.value;t&&u(t)})}catch(e){console.error("[content-manager] init failed",e)}}export{f as init};
