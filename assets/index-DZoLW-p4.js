const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/accolades-ivYdLkd_.js","assets/utils-CFjXnQ4s.js","assets/accolade-Yf9i_eVs.js"])))=>i.map(i=>d[i]);
(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(r){if(r.ep)return;r.ep=!0;const l=i(r);fetch(r.href,l)}})();function A(){document.querySelectorAll("[data-include]").forEach(n=>{const i=n.getAttribute("data-include");i&&fetch(i).then(s=>{if(!s.ok)throw new Error(`Failed to fetch ${i}`);return s.text()}).then(s=>{n.innerHTML=s,i.includes("nav.html")&&document.dispatchEvent(new Event("nav-ready"))}).catch(s=>{console.error(`[includes.js] Error loading ${i}:`,s)})})}const d={apiBase:"https://api.pyrofreelancercorps.com",redirectUri:"https://pyrofreelancercorps.com/",discordClientId:"819004565869035531"};function k(){console.log("finishDiscordLogin triggered.");const n=new URLSearchParams(window.location.search).get("code");if(console.log("Parsed code from URL:",n),!n){console.log("No code found in URL ‚Äî skipping login finish.");return}fetch(`${d.apiBase}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n,redirectUri:d.redirectUri})}).then(i=>(console.log("Received response:",i),i.json())).then(i=>{console.log("Parsed response JSON:",i),i&&i.token?(localStorage.setItem("jwt",i.token),console.log("‚úÖ JWT stored:",i.token)):console.warn("[auth] No token received from API:",i),window.location.href=d.redirectUri}).catch(i=>{console.error("‚ùå Error finishing Discord login:",i)})}function L(){try{const e=localStorage.getItem("jwt");return!e||e==="undefined"?null:JSON.parse(atob(e.split(".")[1]))}catch(e){return console.warn("[auth] Failed to decode JWT:",e),null}}function w(){const e=d==null?void 0:d.discordClientId,n=d==null?void 0:d.redirectUri,i=`https://discord.com/oauth2/authorize?response_type=code&client_id=${e}&scope=identify+guilds.members.read&redirect_uri=${n}`;window.location.href=i}function y(){localStorage.removeItem("jwt"),console.log("üîí Logged out. Reloading..."),window.location.reload()}console.log("[nav] Script start");async function T(e=1e3){const n=["login-btn","logout-btn","user-info","display-name"],i=Date.now();for(;Date.now()-i<e;){if(n.filter(r=>!document.getElementById(r)).length===0)return!0;await new Promise(r=>setTimeout(r,50))}return console.warn("[nav] Timeout waiting for nav elements"),!1}const g=e=>{const n=document.getElementById(e);n&&(console.log(`[nav] Showing ${e}`),n.classList.remove("hidden"))},c=e=>{const n=document.getElementById(e);n&&(console.log(`[nav] Hiding ${e}`),n.classList.add("hidden"),e==="user-info"&&n.classList.remove("lg:inline-block"))};function p(){const e=localStorage.getItem("jwt");console.log("[nav] Token:",e),T().then(()=>{var s,r,l,o,t;let n=null;if(e)try{n=L(),console.log("[nav] User:",n)}catch(v){console.warn("[nav] Failed to get user:",v)}const i=(s=n==null?void 0:n.roles)==null?void 0:s.includes("Server Admin");console.log("[nav] Is admin:",i),(r=document.getElementById("login-btn"))==null||r.addEventListener("click",w),(l=document.getElementById("login-btn-mobile"))==null||l.addEventListener("click",w),(o=document.getElementById("logout-btn"))==null||o.addEventListener("click",y),(t=document.getElementById("logout-btn-mobile"))==null||t.addEventListener("click",y),n?(document.getElementById("display-name").textContent=n.displayName,g("user-info"),g("logout-btn"),g("logout-btn-mobile"),c("login-btn"),c("login-btn-mobile"),i?(g("admin-link"),g("admin-link-mobile"),g("admin-container")):(c("admin-link"),c("admin-link-mobile"),c("admin-container"),window.location.pathname.includes("admin.html")&&(console.log("[nav] Redirecting non-admin"),navigateTo("./unauthorized.html")))):(g("login-btn"),g("login-btn-mobile"),c("logout-btn"),c("logout-btn-mobile"),c("user-info"),c("admin-link"),c("admin-link-mobile"),c("admin-container"),window.location.pathname.includes("admin.html")&&(console.log("[nav] Redirecting unauthenticated user"),navigateTo("./unauthorized.html"))),console.log("[nav] Logic complete")})}document.addEventListener("nav-ready",()=>{console.log("[nav] nav-ready fired"),p()});document.addEventListener("login-success",()=>{console.log("[nav] login-success event received ‚Äî rerunning logic"),p()});document.addEventListener("nav-ready",()=>{console.log("[nav] nav-ready fired");const e=document.getElementById("nav-toggle"),n=document.getElementById("nav-menu-mobile");e&&n?(console.log("[nav] Hamburger elements found ‚Äî binding toggle"),e.addEventListener("click",()=>{console.log("[nav] Toggling mobile menu"),n.classList.toggle("hidden"),n.style.maxHeight=n.classList.contains("hidden")?null:n.scrollHeight+"px"})):console.warn("[nav] Couldn't find nav-toggle or nav-menu-mobile")});function O(){p()}const R="modulepreload",j=function(e){return"/"+e},E={},m=function(n,i,s){let r=Promise.resolve();if(i&&i.length>0){let o=function(a){return Promise.all(a.map(f=>Promise.resolve(f).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),v=(t==null?void 0:t.nonce)||(t==null?void 0:t.getAttribute("nonce"));r=o(i.map(a=>{if(a=j(a),a in E)return;E[a]=!0;const f=a.endsWith(".css"),h=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${h}`))return;const u=document.createElement("link");if(u.rel=f?"stylesheet":R,f||(u.as="script"),u.crossOrigin="",u.href=a,v&&u.setAttribute("nonce",v),document.head.appendChild(u),f)return new Promise((P,S)=>{u.addEventListener("load",P),u.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${a}`)))})}))}function l(o){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=o,window.dispatchEvent(t),!t.defaultPrevented)throw o}return r.then(o=>{for(const t of o||[])t.status==="rejected"&&l(t.reason);return n().catch(l)})},b={"/":"views/home.html","/accolades":"views/accolades.html","/accolade":"views/accolade.html","/events":"views/events.html","/admin":"views/admin.html","/log-search":"views/log-search.html","/unauthorized":"views/unauthorized.html"};function _(e){history.pushState(null,null,e),I()}async function I(){var s;const e=window.location.pathname,n=b[e]||b["/"],i=document.getElementById("view-container");if(console.log(`[router] path: ${e}`),console.log(`[router] route: ${n}`),e==="/admin"||e==="/log-search"){const r=await L(),l=(s=r==null?void 0:r.roles)==null?void 0:s.includes("Server Admin");if(!r||!l){console.warn("[router] Access denied to /admin for non-admin user."),_("/unauthorized");return}}try{console.log(`[router] fetching: /${n}`);const r=await fetch("/"+n);if(!r.ok)throw new Error("Failed to fetch view: "+n);const l=await r.text();i.innerHTML=l,e.includes("accolades")?(console.log("[router] importing accolades.js"),m(()=>import("./accolades-ivYdLkd_.js"),__vite__mapDeps([0,1])).then(o=>{var t;return(t=o.init)==null?void 0:t.call(o)})):e.includes("accolade")?(console.log("[router] importing accolade.js"),m(()=>import("./accolade-Yf9i_eVs.js"),__vite__mapDeps([2,1])).then(o=>{var t;return(t=o.init)==null?void 0:t.call(o)})):e.includes("events")?(console.log("[router] importing events.js"),m(()=>import("./events-ufBHrFLe.js"),[]).then(o=>{var t;return(t=o.init)==null?void 0:t.call(o)})):e.includes("admin")?(console.log("[router] importing admin.js"),m(()=>Promise.resolve().then(()=>U),void 0).then(o=>{var t;return(t=o.init)==null?void 0:t.call(o)})):e.includes("log-search")?(console.log("[router] importing log-search.js"),m(()=>import("./log-search-9T_pHSsZ.js"),[]).then(o=>{var t;return(t=o.init)==null?void 0:t.call(o)})):e.includes("unauthorized")?(console.log("[router] importing unauthorized.js"),m(()=>import("./unauthorized-dsxlyb9t.js"),[]).then(o=>{var t;return(t=o.init)==null?void 0:t.call(o)})):(e==="/"||e==="/home")&&(console.log("[router] importing home.js"),m(()=>import("./home-BmgwPIb3.js"),[]).then(o=>{var t;return(t=o.init)==null?void 0:t.call(o)}))}catch(r){console.error("[router] Error loading route:",r),i.innerHTML='<p class="text-red-500 text-center">Error loading page.</p>'}}function D(){document.body.addEventListener("click",e=>{e.target.matches("a[data-link]")&&(e.preventDefault(),_(e.target.href))}),I()}function B(){D()}console.log("[MAIN] Booting up...");window.addEventListener("DOMContentLoaded",async()=>{if(console.log("[MAIN] DOM loaded"),new URLSearchParams(window.location.search).get("code")){console.log("[Auth] OAuth code found, finishing login...");try{await k()}catch(i){console.error("[Auth] Failed to finish Discord login:",i)}}A(),O(),B(),console.log("[MAIN] Booted up successfully")});const U=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{d as P};
