const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/accolades-KkPV5r-o.js","assets/utils-CFjXnQ4s.js","assets/accolade-sCb_CzQI.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function i(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(o){if(o.ep)return;o.ep=!0;const s=i(o);fetch(o.href,s)}})();async function A(){const e=document.querySelectorAll("[data-include]"),t=Array.from(e).map(async i=>{const l=i.getAttribute("data-include");if(l)try{const o=await fetch(l);if(!o.ok)throw new Error(`Failed to fetch ${l}`);const s=await o.text();i.innerHTML=s,l.includes("nav.html")&&document.dispatchEvent(new Event("nav-ready"))}catch(o){console.error(`[includes.js] Error loading ${l}:`,o)}});return Promise.all(t)}const u={apiBase:"https://api.pyrofreelancercorps.com",redirectUri:"https://pyrofreelancercorps.com/",discordClientId:"819004565869035531",debug:!1};function S(){const t=new URLSearchParams(window.location.search).get("code");t&&fetch(`${u.apiBase}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t,redirectUri:u.redirectUri})}).then(i=>i.json()).then(i=>{i&&i.token?localStorage.setItem("jwt",i.token):console.warn("[auth] No token received from API:",i),window.location.href=u.redirectUri}).catch(i=>{console.error("‚ùå Error finishing Discord login:",i)})}function b(){try{const e=localStorage.getItem("jwt");return!e||e==="undefined"?null:JSON.parse(atob(e.split(".")[1]))}catch(e){return console.warn("[auth] Failed to decode JWT:",e),null}}function y(){const e=u==null?void 0:u.discordClientId,t=u==null?void 0:u.redirectUri,i=`https://discord.com/oauth2/authorize?response_type=code&client_id=${e}&scope=identify+guilds.members.read&redirect_uri=${t}`;window.location.href=i}function L(){localStorage.removeItem("jwt"),window.location.reload()}const D=u.debug;async function B(e=1e3){const t=["login-btn","logout-btn","user-info","display-name"],i=Date.now();for(;Date.now()-i<e;){if(t.filter(o=>!document.getElementById(o)).length===0)return!0;await new Promise(o=>setTimeout(o,50))}return console.warn("[nav] Timeout waiting for nav elements"),!1}const h=e=>{const t=document.getElementById(e);t&&t.classList.remove("hidden")},d=e=>{const t=document.getElementById(e);t&&(t.classList.add("hidden"),e==="user-info"&&t.classList.remove("lg:inline-block"))};function E(){const e=localStorage.getItem("jwt");B().then(()=>{var l,o,s,a,c;let t=null;if(e)try{t=b()}catch(v){console.warn("[nav] Failed to get user:",v)}const i=(l=t==null?void 0:t.roles)==null?void 0:l.includes("Server Admin");(o=document.getElementById("login-btn"))==null||o.addEventListener("click",y),(s=document.getElementById("login-btn-mobile"))==null||s.addEventListener("click",y),(a=document.getElementById("logout-btn"))==null||a.addEventListener("click",L),(c=document.getElementById("logout-btn-mobile"))==null||c.addEventListener("click",L),t?(document.getElementById("display-name").textContent=t.displayName,h("user-info"),h("logout-btn"),h("logout-btn-mobile"),d("login-btn"),d("login-btn-mobile"),i?(h("admin-link"),h("admin-link-mobile"),h("admin-container")):(d("admin-link"),d("admin-link-mobile"),d("admin-container"),window.location.pathname.includes("admin.html")&&navigateTo("./unauthorized.html"))):(h("login-btn"),h("login-btn-mobile"),d("logout-btn"),d("logout-btn-mobile"),d("user-info"),d("admin-link"),d("admin-link-mobile"),d("admin-container"),window.location.pathname.includes("admin.html")&&navigateTo("./unauthorized.html"))})}document.addEventListener("nav-ready",()=>{E()});document.addEventListener("login-success",()=>{E()});document.addEventListener("nav-ready",()=>{const e=document.getElementById("nav-toggle"),t=document.getElementById("nav-menu-mobile");e&&t?e.addEventListener("click",()=>{t.classList.toggle("hidden"),t.style.maxHeight=t.classList.contains("hidden")?null:t.scrollHeight+"px"}):console.warn("[nav] Couldn't find nav-toggle or nav-menu-mobile")});function O(){E()}const R="modulepreload",U=function(e){return"/"+e},_={},g=function(t,i,l){let o=Promise.resolve();if(i&&i.length>0){let a=function(n){return Promise.all(n.map(r=>Promise.resolve(r).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),v=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));o=a(i.map(n=>{if(n=U(n),n in _)return;_[n]=!0;const r=n.endsWith(".css"),p=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${p}`))return;const m=document.createElement("link");if(m.rel=r?"stylesheet":R,r||(m.as="script"),m.crossOrigin="",m.href=n,v&&m.setAttribute("nonce",v),document.head.appendChild(m),r)return new Promise((T,k)=>{m.addEventListener("load",T),m.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${n}`)))})}))}function s(a){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a}return o.then(a=>{for(const c of a||[])c.status==="rejected"&&s(c.reason);return t().catch(s)})},f=u.debug,w={"/":"views/home.html","/accolades":"views/accolades.html","/accolade":"views/accolade.html","/events":"views/events.html","/admin":"views/admin.html","/log-search":"views/log-search.html","/unauthorized":"views/unauthorized.html","/shop":"views/shop.html","/product/:handle":"views/shop.html"};function I(e){history.pushState(null,null,e),P()}async function P(){var l;const e=window.location.pathname;let t=w[e];t||(e.startsWith("/product/")?t=w["/product/:handle"]:t=w["/"]);const i=document.getElementById("view-container");if(!i){console.error("[router] view-container not found!");return}if(e==="/admin"||e==="/log-search"){const o=await b(),s=(l=o==null?void 0:o.roles)==null?void 0:l.includes("Server Admin");if(!o||!s){console.warn("[router] Access denied to /admin for non-admin user."),I("/unauthorized");return}}try{const o=await fetch("/"+t);if(!o.ok)throw new Error("Failed to fetch view: "+t);const s=await o.text(),a=document.createElement("div");a.innerHTML=s;const c=a.querySelector("#view-container");c?i.innerHTML=c.innerHTML:i.innerHTML=s;const v=new Event("nav-ready");window.dispatchEvent(v),e.includes("accolades")?g(()=>import("./accolades-KkPV5r-o.js"),__vite__mapDeps([0,1])).then(n=>{var r;return(r=n.init)==null?void 0:r.call(n)}):e.includes("accolade")?g(()=>import("./accolade-sCb_CzQI.js"),__vite__mapDeps([2,1])).then(n=>{var r;return(r=n.init)==null?void 0:r.call(n)}):e.includes("events")?g(()=>import("./events-BvAnfybw.js"),[]).then(n=>{var r;return(r=n.init)==null?void 0:r.call(n)}):e.includes("admin")?g(()=>import("./admin-BQloDxEK.js"),[]).then(n=>{var r;return(r=n.init)==null?void 0:r.call(n)}):e.includes("log-search")?g(()=>import("./log-search-Dgs-wmeG.js"),[]).then(n=>{var r;return(r=n.init)==null?void 0:r.call(n)}):e.includes("unauthorized")?g(()=>import("./unauthorized-CzpNAiM6.js"),[]).then(n=>{var r;return(r=n.init)==null?void 0:r.call(n)}):e==="/"||e==="/home"?g(()=>import("./home-4LZIsAXR.js"),[]).then(n=>{var r;return(r=n.init)==null?void 0:r.call(n)}):(e.startsWith("/shop")||e.startsWith("/product/"))&&g(()=>import("./shop-DNcuPkB9.js"),[]).then(n=>{var r;return(r=n.init)==null?void 0:r.call(n,e)})}catch(o){console.error("[router] Error loading route:",o),i.innerHTML='<p class="text-red-500 text-center">Error loading page.</p>'}}function $(){document.body.addEventListener("click",e=>{e.target.matches("a[data-link]")&&(e.preventDefault(),I(e.target.href))}),P()}function j(){$()}window.addEventListener("DOMContentLoaded",async()=>{if(new URLSearchParams(window.location.search).get("code"))try{await S()}catch(i){console.error("[Auth] Failed to finish Discord login:",i)}A(),O(),j()});export{u as P,b as g};
