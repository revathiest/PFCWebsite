const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/accolades-DFWJW6zh.js","assets/utils-CFjXnQ4s.js","assets/accolade-Hl_utmPT.js"])))=>i.map(i=>d[i]);
(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function r(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(t){if(t.ep)return;t.ep=!0;const s=r(t);fetch(t.href,s)}})();async function S(){const e=document.querySelectorAll("[data-include]"),n=Array.from(e).map(async r=>{const c=r.getAttribute("data-include");if(c)try{const t=await fetch(c);if(!t.ok)throw new Error(`Failed to fetch ${c}`);const s=await t.text();r.innerHTML=s,c.includes("nav.html")&&document.dispatchEvent(new Event("nav-ready"))}catch(t){console.error(`[includes.js] Error loading ${c}:`,t)}});return Promise.all(n)}const O=typeof window<"u"?window.PFC_CONFIG||{}:{},f={apiBase:"https://api.pyrofreelancercorps.com",redirectUri:"https://pyrofreelancercorps.com/",discordClientId:"819004565869035531",shopifyDomain:"pfc-commissary.myshopify.com",shopifyStorefrontToken:"33522d6190a58189d30ed85f4c48549f",debug:O.debug||!1},v=f.debug;function B(){v&&console.log("finishDiscordLogin triggered.");const n=new URLSearchParams(window.location.search).get("code");if(v&&console.log("Parsed code from URL:",n),!n){v&&console.log("No code found in URL ‚Äî skipping login finish.");return}fetch(`${f.apiBase}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n,redirectUri:f.redirectUri})}).then(r=>(v&&console.log("Received response:",r),r.json())).then(r=>{v&&console.log("Parsed response JSON:",r),r&&r.token?(localStorage.setItem("jwt",r.token),v&&console.log("‚úÖ JWT stored:",r.token)):console.warn("[auth] No token received from API:",r),window.location.href=f.redirectUri}).catch(r=>{console.error("‚ùå Error finishing Discord login:",r)})}function T(){try{const e=localStorage.getItem("jwt");return!e||e==="undefined"?null:JSON.parse(atob(e.split(".")[1]))}catch(e){return console.warn("[auth] Failed to decode JWT:",e),null}}function b(){const e=f==null?void 0:f.discordClientId,n=f==null?void 0:f.redirectUri,r=`https://discord.com/oauth2/authorize?response_type=code&client_id=${e}&scope=identify+guilds.members.read&redirect_uri=${n}`;window.location.href=r}function I(){localStorage.removeItem("jwt"),v&&console.log("üîí Logged out. Reloading..."),window.location.reload()}const d=f.debug;d&&console.log("[nav] Script start");async function j(e=1e3){const n=["login-btn","logout-btn","user-info","display-name"],r=Date.now();for(;Date.now()-r<e;){if(n.filter(t=>!document.getElementById(t)).length===0)return!0;await new Promise(t=>setTimeout(t,50))}return console.warn("[nav] Timeout waiting for nav elements"),!1}const p=e=>{const n=document.getElementById(e);n&&(d&&console.log(`[nav] Showing ${e}`),n.classList.remove("hidden"))},g=e=>{const n=document.getElementById(e);n&&(d&&console.log(`[nav] Hiding ${e}`),n.classList.add("hidden"),e==="user-info"&&n.classList.remove("lg:inline-block"))};function L(){const e=localStorage.getItem("jwt");d&&console.log("[nav] Token:",e),j().then(()=>{var c,t,s,a,l;let n=null;if(e)try{n=T(),d&&console.log("[nav] User:",n)}catch(w){console.warn("[nav] Failed to get user:",w)}const r=(c=n==null?void 0:n.roles)==null?void 0:c.includes("Fleet Admiral");d&&console.log("[nav] Is admin:",r),(t=document.getElementById("login-btn"))==null||t.addEventListener("click",b),(s=document.getElementById("login-btn-mobile"))==null||s.addEventListener("click",b),(a=document.getElementById("logout-btn"))==null||a.addEventListener("click",I),(l=document.getElementById("logout-btn-mobile"))==null||l.addEventListener("click",I),n?(document.getElementById("display-name").textContent=n.displayName,p("user-info"),p("logout-btn"),p("logout-btn-mobile"),g("login-btn"),g("login-btn-mobile"),r?(p("admin-link"),p("admin-link-mobile"),p("admin-container")):(g("admin-link"),g("admin-link-mobile"),g("admin-container"),window.location.pathname.includes("admin.html")&&(d&&console.log("[nav] Redirecting non-admin"),navigateTo("./unauthorized.html")))):(p("login-btn"),p("login-btn-mobile"),g("logout-btn"),g("logout-btn-mobile"),g("user-info"),g("admin-link"),g("admin-link-mobile"),g("admin-container"),window.location.pathname.includes("admin.html")&&(d&&console.log("[nav] Redirecting unauthenticated user"),navigateTo("./unauthorized.html"))),d&&console.log("[nav] Logic complete")})}document.addEventListener("nav-ready",()=>{d&&console.log("[nav] nav-ready fired"),L()});document.addEventListener("login-success",()=>{d&&console.log("[nav] login-success event received ‚Äî rerunning logic"),L()});document.addEventListener("nav-ready",()=>{d&&console.log("[nav] nav-ready fired");const e=document.getElementById("nav-toggle"),n=document.getElementById("nav-menu-mobile");e&&n?(d&&console.log("[nav] Hamburger elements found ‚Äî binding toggle"),e.addEventListener("click",()=>{d&&console.log("[nav] Toggling mobile menu"),n.classList.toggle("hidden"),n.style.maxHeight=n.classList.contains("hidden")?null:n.scrollHeight+"px"})):console.warn("[nav] Couldn't find nav-toggle or nav-menu-mobile")});function U(){L()}const $="modulepreload",N=function(e){return"/"+e},P={},m=function(n,r,c){let t=Promise.resolve();if(r&&r.length>0){let a=function(o){return Promise.all(o.map(i=>Promise.resolve(i).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),w=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));t=a(r.map(o=>{if(o=N(o),o in P)return;P[o]=!0;const i=o.endsWith(".css"),y=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${y}`))return;const h=document.createElement("link");if(h.rel=i?"stylesheet":$,i||(h.as="script"),h.crossOrigin="",h.href=o,w&&h.setAttribute("nonce",w),document.head.appendChild(h),i)return new Promise((k,R)=>{h.addEventListener("load",k),h.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${o}`)))})}))}function s(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return t.then(a=>{for(const l of a||[])l.status==="rejected"&&s(l.reason);return n().catch(s)})},u=f.debug,_={"/":"views/home.html","/accolades":"views/accolades.html","/accolade":"views/accolade.html","/events":"views/events.html","/officers":"views/officers.html","/admin":"views/admin.html","/log-search":"views/log-search.html","/content-manager":"views/content-manager.html","/unauthorized":"views/unauthorized.html","/shop":"views/shop.html","/product/:handle":"views/shop.html"};function A(e){history.pushState(null,null,e),D()}async function D(){var c;const e=window.location.pathname;let n=_[e];n||(e.startsWith("/product/")?n=_["/product/:handle"]:n=_["/"]);const r=document.getElementById("view-container");if(!r){console.error("[router] view-container not found!");return}if(u&&console.log(`[router] path: ${e}`),u&&console.log(`[router] route: ${n}`),e==="/admin"||e==="/log-search"||e==="/content-manager"){const t=await T(),s=(c=t==null?void 0:t.roles)==null?void 0:c.includes("Fleet Admiral");if(!t||!s){console.warn("[router] Access denied to /admin for non-admin user."),A("/unauthorized");return}}try{u&&console.log(`[router] fetching: /${n}`);const t=await fetch("/"+n);if(!t.ok)throw new Error("Failed to fetch view: "+n);const s=await t.text(),a=document.createElement("div");a.innerHTML=s;const l=a.querySelector("#view-container");l?r.innerHTML=l.innerHTML:r.innerHTML=s;const w=new Event("nav-ready");window.dispatchEvent(w),e.includes("accolades")?(u&&console.log("[router] importing accolades.js"),m(()=>import("./accolades-DFWJW6zh.js"),__vite__mapDeps([0,1])).then(o=>{var i;return(i=o.init)==null?void 0:i.call(o)})):e.includes("accolade")?(u&&console.log("[router] importing accolade.js"),m(()=>import("./accolade-Hl_utmPT.js"),__vite__mapDeps([2,1])).then(o=>{var i;return(i=o.init)==null?void 0:i.call(o)})):e.includes("events")?(u&&console.log("[router] importing events.js"),m(()=>import("./events-BcVFyTJZ.js"),[]).then(o=>{var i;return(i=o.init)==null?void 0:i.call(o)})):e.includes("officers")?(u&&console.log("[router] importing officers.js"),m(()=>import("./officers-DpFbGWYY.js"),[]).then(o=>{var i;return(i=o.init)==null?void 0:i.call(o)})):e.includes("admin")?(u&&console.log("[router] importing admin.js"),m(()=>import("./admin-BO-lpqHy.js"),[]).then(o=>{var i;return(i=o.init)==null?void 0:i.call(o)})):e.includes("log-search")?(u&&console.log("[router] importing log-search.js"),m(()=>import("./log-search-nGZ28GH5.js"),[]).then(o=>{var i;return(i=o.init)==null?void 0:i.call(o)})):e.includes("content-manager")?(u&&console.log("[router] importing content-manager.js"),m(()=>import("./content-manager-D4RSVQwE.js"),[]).then(o=>{var i;return(i=o.init)==null?void 0:i.call(o)})):e.includes("unauthorized")?(u&&console.log("[router] importing unauthorized.js"),m(()=>import("./unauthorized-CNEGjnhw.js"),[]).then(o=>{var i;return(i=o.init)==null?void 0:i.call(o)})):e==="/"||e==="/home"?(u&&console.log("[router] importing home.js"),m(()=>import("./home-DDcu6042.js"),[]).then(o=>{var i;return(i=o.init)==null?void 0:i.call(o)})):(e.startsWith("/shop")||e.startsWith("/product/"))&&(u&&console.log("[router] importing shop.js"),m(()=>import("./shop-dEv3Cc2l.js"),[]).then(o=>{var i;return(i=o.init)==null?void 0:i.call(o,e)}))}catch(t){console.error("[router] Error loading route:",t),r.innerHTML='<p class="text-red-500 text-center">Error loading page.</p>'}}function V(){document.body.addEventListener("click",e=>{e.target.matches("a[data-link]")&&(e.preventDefault(),A(e.target.href))}),D()}function H(){V()}const E=f.debug;E&&console.log("[MAIN] Booting up...");window.addEventListener("DOMContentLoaded",async()=>{if(E&&console.log("[MAIN] DOM loaded"),new URLSearchParams(window.location.search).get("code")){E&&console.log("[Auth] OAuth code found, finishing login...");try{await B()}catch(r){console.error("[Auth] Failed to finish Discord login:",r)}}S(),U(),H(),E&&console.log("[MAIN] Booted up successfully")});export{f as P,T as g};
